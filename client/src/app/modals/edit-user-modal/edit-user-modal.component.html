<form #userForm="ngForm" (submit)="$event.preventDefault()">
    <div class="modal-header">
        <h5 class="modal-title">Edit User: {{ user.name }} {{ user.surname }}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="attemptClose()"></button>
    </div>

    <div class="modal-body">
        <!-- First Name -->
        <div class="mb-3">
            <label for="firstName" class="form-label">First Name</label>
            <input type="text" id="firstName" class="form-control" [ngClass]="{'is-invalid': !!firstNameError}"
                [(ngModel)]="firstName" name="firstName" (ngModelChange)="onFirstNameChange($event)">
            <div class="invalid-feedback" *ngIf="firstNameError">{{ firstNameError }}</div>
        </div>

        <!-- Last Name -->
        <div class="mb-3">
            <label for="lastName" class="form-label">Last Name</label>
            <input type="text" id="lastName" class="form-control" [ngClass]="{'is-invalid': !!lastNameError}"
                [(ngModel)]="lastName" name="lastName" (ngModelChange)="onLastNameChange($event)">
            <div class="invalid-feedback" *ngIf="lastNameError">{{ lastNameError }}</div>
        </div>

        <!-- Email -->
        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-control" [ngClass]="{'is-invalid': !!emailError}"
                [(ngModel)]="email" name="email" (ngModelChange)="onEmailChange($event)">
            <div class="invalid-feedback" *ngIf="emailError">
                {{ emailError }}
            </div>
        </div>

        <!-- Update Password (optional) + live checklist -->
        <div class="mb-3">
            <label for="password" class="form-label">Update Password</label>
            <div class="input-group">
                <input [type]="showPassword ? 'text' : 'password'" id="password" class="form-control"
                    [ngClass]="{'is-invalid': !!passwordError}" [(ngModel)]="updatePassword" name="updatePassword"
                    placeholder="Leave blank to keep current password" (ngModelChange)="onPasswordChange($event)" />
                <span class="input-group-text" style="cursor: pointer;" (click)="togglePasswordVisibility()">
                    <i class="fas" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                </span>
                <div class="invalid-feedback" *ngIf="passwordError">{{ passwordError }}</div>
            </div>

            <!-- Checklist only when user is typing a new password -->
            <ul class="mt-2 mb-0 small" style="list-style:none; padding-left:0;" *ngIf="updatePassword">
                <li><span>{{ pwMinLen ? '✓' : '✗' }}</span> Minimum 8 characters</li>
                <li><span>{{ pwUpper ? '✓' : '✗' }}</span> 1 uppercase letter</li>
                <li><span>{{ pwLower ? '✓' : '✗' }}</span> 1 lowercase letter</li>
                <li><span>{{ pwDigit ? '✓' : '✗' }}</span> 1 digit</li>
                <li><span>{{ pwSymbol ? '✓' : '✗' }}</span> 1 symbol (non-alphanumeric)</li>
            </ul>
        </div>

        <!-- Roles (unchanged) -->
        <label class="form-label">Roles</label>
        <div *ngFor="let role of roles">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" [checked]="selectedRoles.includes(role)"
                    (change)="toggleRole(role, $event)" [id]="'role-' + role" />
                <label class="form-check-label" [for]="'role-' + role">{{ role }}</label>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="attemptClose()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="submit()" [disabled]="!formValid">Save</button>
    </div>
</form>