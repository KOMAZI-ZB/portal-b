<div class="container mt-4 modules-page">
    <h2 class="mb-0">Modules</h2>

    <!-- Top row: Title (left) | Select Semester (right) -->
    <div class="top-row">
        <!-- Title lives here; becomes "All Modules" when a coordinator has no assigned modules -->
        <h5 class="mb-0 section-title">{{ topRowTitle }}</h5>

        <div class="semester-filter">
            <label for="semester" class="h5 mb-0 section-title">Select Semester:</label>
            <select id="semester" class="form-select w-auto" name="semester" [(ngModel)]="selectedSemester"
                (change)="onSemesterChange()">
                <option [value]="1">Semester 1</option>
                <option [value]="2">Semester 2</option>
            </select>
        </div>
    </div>

    <!-- Coordinator grouped view -->
    <ng-container *ngIf="isCoordinator; else defaultList">

        <!-- Assigned modules grid (only when there are assigned modules) -->
        <ng-container *ngIf="showAssignedSection">
            <div class="modules-grid" role="list">
                <div class="module-card" role="listitem" *ngFor="let module of assignedModules"
                    (click)="openModule(module)" tabindex="0">
                    <div class="module-card__code">{{ module.moduleCode }}</div>
                    <div class="module-card__name">{{ module.moduleName }}</div>
                </div>
            </div>

            <!-- Only show this heading if there *are* assigned modules -->
            <div class="section-heading">
                <h5 class="mb-0 section-title">Other Modules</h5>
            </div>
        </ng-container>

        <!-- Lower grid: shows "other" when assigned exist; otherwise this is effectively "All Modules" -->
        <div class="modules-grid" role="list">
            <div class="module-card" role="listitem" *ngFor="let module of otherModules" (click)="openModule(module)"
                tabindex="0">
                <div class="module-card__code">{{ module.moduleCode }}</div>
                <div class="module-card__name">{{ module.moduleName }}</div>
            </div>

            <div *ngIf="otherModules.length === 0" class="text-muted grid-empty">
                {{ isAllModulesMode ? 'No modules found for this semester.' : 'No other modules found for this
                semester.' }}
            </div>
        </div>
    </ng-container>

    <!-- Original list for non-coordinators (Lecturers & Students) -->
    <ng-template #defaultList>
        <div class="modules-grid" role="list">
            <div class="module-card" role="listitem" *ngFor="let module of modules" (click)="openModule(module)"
                tabindex="0">
                <div class="module-card__code">{{ module.moduleCode }}</div>
                <div class="module-card__name">{{ module.moduleName }}</div>
            </div>

            <div *ngIf="modules.length === 0" class="text-muted grid-empty">
                No modules found for this semester.
            </div>
        </div>
    </ng-template>
</div>